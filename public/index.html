<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assessment.css">
    <title>あなたの推し診断</title>
  </head>
  <body>
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
      import { getAuth, createUserWithEmailAndPassword, onAuthStateChanged, signOut, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyB2Sh6i-lmdFwi30BCw5rHMAp2xwxxlSOo",
        authDomain: "temporal-parser-484702-r9.firebaseapp.com",
        projectId: "temporal-parser-484702-r9",
        storageBucket: "temporal-parser-484702-r9.firebasestorage.app",
        messagingSenderId: "405321141261",
        appId: "1:405321141261:web:8f0846e83bcc2297085944",
        measurementId: "G-Z6ZLDE2GHD"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const auth = getAuth(app);

      // 新規会員登録処理
      const registerForm = document.getElementById('register-form');
      const registerMailAddressInput = document.getElementById('registerMailAddress');
      const registerPasswordInput = document.getElementById('registerPassword');
      const userEmailText = document.getElementById('user-email-text');
      registerForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const mailAddress = registerMailAddressInput.value;
        const password = registerPasswordInput.value;
        if (!mailAddress || !password) {
          return;
        }
        createUserWithEmailAndPassword(auth, mailAddress, password)
        .then(() => {
          // 新規会員登録フォームを初期化
          registerMailAddressInput.value = '';
          registerPasswordInput.value = '';
        })
        .catch((error) => {
          alert('登録に失敗しました[' + error.message + ']');
        });

      });

      // ログアウト処理
      const logoutButton = document.getElementById('logoutButton');
      logoutButton.addEventListener('click', () => {
        signOut(auth);
      });

      // ログイン周りの処理の各エリア
      const userArea = document.getElementById('user-area');
      const loginArea = document.getElementById('login-area');
      const registerArea = document.getElementById('register-area');

      onAuthStateChanged(auth, (user) => {


        // ログイン周りの処理の各エリア全てを一旦非表示にする
        userArea.style.display = 'none';
        loginArea.style.display = 'none';
        registerArea.style.display = 'none';

        if (user) {
          userEmailText.innerText = user.email;
          // ログインしている場合のエリアを表示する
          userArea.style.display = 'block';
        } else {
          userEmailText.innerText = '';
          // ログインしていない場合のエリアを表示する
          loginArea.style.display = 'block';
          registerArea.style.display = 'block';
        }
      });
    </script>
    <h1>あなたの推し診断</h1>
    <p>あなたの名前を入れると、おすすめの推しを診断します！</p>
    <input type="text" id="user-name" size="40" maxlength="20" placeholder="名前を入力...">
    <button id="assessment">診断する</button>
    <div id="result-area"></div>
    <div id="tweet-area"></div>
    <div id="user-area">
      <hr />
      ようこそ <span id="user-email-text"></span> さん
      <button id="logoutButton">ログアウト</button>
    </div>
    <div id="login-area">
      <hr />
      <h2>ログイン</h2>
      <form action="#" id="login-form">
        <div>
          メールアドレス<input id="mailAddress" type="email" size="40" required/>
        </div>
        <div>
          パスワード<input id="password" type="password" size="40" required/>
        </div>
        <p>
          <button type="submit">ログイン</button>
        </p>
      </form>
    </div>
    <div id="register-area">
      <hr />
      <h2>新規会員登録</h2>
      <form action="#" id="register-form">
        <div>
          メールアドレス<input id="registerMailAddress" type="email" size="40" required/>
        </div>
        <div>
          パスワード<input id="registerPassword" type="password" size="40" required/>
        </div>
        <p>
          <button type="submit">新規会員登録</button>
        </p>
      </form>
    </div>
    <script src="assessment.js"></script>
  </body>
</html>
